================================================================================
PROJECT ARCHITECTURE & WORKFLOW DOCUMENTATION
================================================================================

PROJECT NAME: Multi-Agent Durable AI Workflow
SOLUTION: Ai_ Frontend.sln
LOCATION: c:\Users\maddi\OneDrive\Desktop\multi_agents\Ai_ Frontend

================================================================================
SOLUTION STRUCTURE
================================================================================

Ai_ Frontend/
│
├── multiple_Agents/              # Blazor Frontend Application
│   ├── Components/
│   │   ├── Pages/
│   │   │   └── Home.razor        # Main UI for workflow interaction
│   │   ├── Layout/
│   │   └── App.razor
│   ├── Orchestration/
│   │   └── ConversationOrchestrator.cs
│   ├── Agents/
│   │   ├── ReaderAgent.cs
│   │   └── ResponderAgent.cs
│   ├── Memory/
│   │   └── ConversationMemory.cs
│   ├── Program.cs                # App configuration & DI setup
│   └── appsettings.json          # Backend URL configuration
│
├── DurableBackend/               # Azure Durable Functions Backend
│   ├── HttpStart.cs              # HTTP trigger entry point
│   ├── ConversationOrchestrator.cs  # Durable orchestrator
│   ├── GraphActivity.cs          # Activity function
│   ├── AI/
│   │   ├── IAiClient.cs          # AI client interface
│   │   ├── LangChainAiClient.cs  # LangChain implementation
│   │   ├── OllamaAiClient.cs     # Ollama implementation
│   │   └── Graph/
│   │       ├── LangGraphAgent.cs # Main agent logic
│   │       ├── AgentState.cs     # State management
│   │       ├── AnalysisNode.cs   # Analysis processing
│   │       ├── ResponseNode.cs   # Response generation
│   │       └── StateGraph.cs     # Graph workflow
│   ├── Program.cs                # Function app configuration
│   ├── host.json                 # Function host settings
│   └── local.settings.json       # Local development settings
│
├── Ai_ Frontend.ServiceDefaults/ # Shared service defaults
└── Ai_ Frontend.AppHost/         # Aspire app host


================================================================================
ARCHITECTURE OVERVIEW
================================================================================

┌─────────────────────────────────────────────────────────────────────────┐
│                            USER INTERFACE                                │
│                         (Blazor Frontend)                                │
│                                                                           │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  Home.razor                                                      │   │
│  │  - Input field for user text                                    │   │
│  │  - "Start Workflow" button                                      │   │
│  │  - Status display                                               │   │
│  │  - Result display                                               │   │
│  └─────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    │ HTTP Request
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                      AZURE DURABLE FUNCTIONS                             │
│                         (Backend Services)                               │
│                                                                           │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  HttpStart.cs (HTTP Trigger)                                    │   │
│  │  Route: /api/start/{input}                                      │   │
│  │  - Receives user input                                          │   │
│  │  - Creates orchestration instance                               │   │
│  │  - Returns instanceId                                           │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                    │                                     │
│                                    ▼                                     │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  ConversationOrchestrator.cs (Orchestrator)                     │   │
│  │  - Manages workflow execution                                   │   │
│  │  - Calls GraphActivity                                          │   │
│  │  - Returns final result                                         │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                    │                                     │
│                                    ▼                                     │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  GraphActivity.cs (Activity Function)                           │   │
│  │  - Executes LangGraphAgent                                      │   │
│  │  - Processes user input through AI workflow                     │   │
│  │  - Returns AI-generated response                                │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                    │                                     │
│                                    ▼                                     │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  LangGraphAgent.cs (AI Processing)                              │   │
│  │  ┌───────────────────────────────────────────────────────────┐ │   │
│  │  │  State Graph Workflow:                                     │ │   │
│  │  │  1. AnalysisNode  → Analyzes input                        │ │   │
│  │  │  2. ResponseNode  → Generates response                    │ │   │
│  │  │  3. Returns final result                                  │ │   │
│  │  └───────────────────────────────────────────────────────────┘ │   │
│  └─────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────┘


================================================================================
DETAILED WORKFLOW - STEP BY STEP
================================================================================

STEP 1: User Interaction (Frontend)
------------------------------------
File: multiple_Agents/Components/Pages/Home.razor

1. User enters text in input field
2. User clicks "Start Workflow" button
3. StartWorkflow() method is triggered


STEP 2: HTTP Request to Azure
------------------------------
File: multiple_Agents/Components/Pages/Home.razor (Line 35)

1. Creates HTTP client using HttpClientFactory
2. Sends GET request to: /api/start/{userInput}
3. Request goes to Azure: https://durable-backend-fn.azurewebsites.net


STEP 3: HTTP Trigger Receives Request
--------------------------------------
File: DurableBackend/HttpStart.cs

1. StartConversation function receives request
2. Extracts input parameter from route
3. Creates new orchestration instance:
   - Orchestrator: "ConversationOrchestrator"
   - Input: user's text
4. Returns JSON with instanceId:
   { "instanceId": "abc-123-def-456" }


STEP 4: Frontend Receives Instance ID
--------------------------------------
File: multiple_Agents/Components/Pages/Home.razor (Line 37-41)

1. Parses JSON response
2. Extracts instanceId
3. Updates status: "Workflow started (ID: {instanceId})"
4. Begins polling for status


STEP 5: Orchestrator Executes
------------------------------
File: DurableBackend/ConversationOrchestrator.cs

1. Orchestrator receives input
2. Calls GraphActivity with input:
   await context.CallActivityAsync<string>("GraphActivity", input)
3. Waits for activity to complete
4. Returns result: { result: "..." }


STEP 6: GraphActivity Processes Input
--------------------------------------
File: DurableBackend/GraphActivity.cs

1. Receives input from orchestrator
2. Logs: "GraphActivity started with input: {input}"
3. Calls LangGraphAgent.RunAsync(input)
4. Waits for AI processing
5. Logs: "GraphActivity completed successfully"
6. Returns result to orchestrator


STEP 7: LangGraph AI Processing
--------------------------------
File: DurableBackend/AI/Graph/LangGraphAgent.cs

1. Initializes agent state with user input
2. Executes state graph workflow:
   
   a) AnalysisNode (AI/Graph/AnalysisNode.cs):
      - Analyzes user input
      - Extracts intent and context
      - Updates state with analysis
   
   b) ResponseNode (AI/Graph/ResponseNode.cs):
      - Generates appropriate response
      - Uses LangChain/Ollama AI client
      - Updates state with response
   
3. Returns final response string


STEP 8: Frontend Polls for Status
----------------------------------
File: multiple_Agents/Components/Pages/Home.razor (Line 60-62)

1. Every 1 second, sends GET request to:
   /runtime/webhooks/durabletask/instances/{instanceId}
2. Checks runtimeStatus property
3. Updates UI with current status


STEP 9: Workflow Completion
----------------------------
File: multiple_Agents/Components/Pages/Home.razor (Line 69-76)

1. When runtimeStatus == "Completed":
2. Extracts output from response
3. Displays result in UI
4. Updates status: "Workflow completed"
5. Stops polling


================================================================================
DATA FLOW DIAGRAM
================================================================================

User Input
    │
    ▼
[Home.razor] ──HTTP GET──> [HttpStart.cs]
    │                           │
    │                           ▼
    │                    Create Orchestration
    │                           │
    │                           ▼
    │                  [ConversationOrchestrator.cs]
    │                           │
    │                           ▼
    │                    [GraphActivity.cs]
    │                           │
    │                           ▼
    │                    [LangGraphAgent.cs]
    │                           │
    │                      ┌────┴────┐
    │                      ▼         ▼
    │              [AnalysisNode] [ResponseNode]
    │                      │         │
    │                      └────┬────┘
    │                           │
    │                           ▼
    │                      AI Response
    │                           │
    ▼                           ▼
Poll Status <───────────── Return Result
    │
    ▼
Display Result


================================================================================
KEY COMPONENTS EXPLAINED
================================================================================

1. BLAZOR FRONTEND (multiple_Agents)
   ----------------------------------
   Purpose: User interface for interacting with AI workflow
   Technology: ASP.NET Core Blazor Server
   Key Features:
   - Interactive UI with real-time updates
   - HTTP client for backend communication
   - Status polling mechanism
   - Result display


2. AZURE DURABLE FUNCTIONS (DurableBackend)
   -----------------------------------------
   Purpose: Serverless backend for orchestrating AI workflow
   Technology: Azure Functions with Durable Task Framework
   Key Features:
   - HTTP triggers for external access
   - Orchestrators for workflow management
   - Activities for processing tasks
   - State persistence
   - Automatic retry and error handling


3. HTTP TRIGGER (HttpStart.cs)
   ----------------------------
   Purpose: Entry point for external requests
   Route: /api/start/{input}
   Method: GET
   Returns: { "instanceId": "..." }


4. ORCHESTRATOR (ConversationOrchestrator.cs)
   ------------------------------------------
   Purpose: Coordinates workflow execution
   Features:
   - Calls activities in sequence
   - Manages state
   - Handles failures
   - Returns final result


5. ACTIVITY FUNCTION (GraphActivity.cs)
   ------------------------------------
   Purpose: Executes AI processing
   Features:
   - Dependency injection (LangGraphAgent)
   - Error logging
   - Exception handling


6. LANGGRAPH AGENT (LangGraphAgent.cs)
   -----------------------------------
   Purpose: AI workflow orchestration
   Components:
   - State management (AgentState.cs)
   - Analysis node (AnalysisNode.cs)
   - Response node (ResponseNode.cs)
   - State graph (StateGraph.cs)


7. AI CLIENTS
   ----------
   - IAiClient.cs: Interface for AI services
   - LangChainAiClient.cs: LangChain implementation
   - OllamaAiClient.cs: Ollama local model implementation


================================================================================
CONFIGURATION
================================================================================

FRONTEND CONFIGURATION
----------------------
File: multiple_Agents/appsettings.json

{
  "DurableBackendUrl": "https://durable-backend-fn.azurewebsites.net"
}

Options:
- Local: "http://localhost:7071"
- Azure: "https://durable-backend-fn.azurewebsites.net"


BACKEND CONFIGURATION
---------------------
File: DurableBackend/local.settings.json

{
  "AzureWebJobsStorage": "UseDevelopmentStorage=true",
  "FUNCTIONS_WORKER_RUNTIME": "dotnet-isolated"
}


DEPENDENCY INJECTION
--------------------
File: DurableBackend/Program.cs

builder.Services.AddSingleton<IAiClient, LangChainAiClient>();
builder.Services.AddSingleton<LangGraphAgent>();


File: multiple_Agents/Program.cs

builder.Services.AddHttpClient("durable", (sp, client) => {
    var backendUrl = config["DurableBackendUrl"] ?? "http://localhost:7071";
    client.BaseAddress = new Uri(backendUrl);
});


================================================================================
DEPLOYMENT ARCHITECTURE
================================================================================

LOCAL DEVELOPMENT
-----------------
Frontend:  http://localhost:5000 (or assigned port)
Backend:   http://localhost:7071

Run Commands:
1. Terminal 1: cd DurableBackend && dotnet run
2. Terminal 2: cd multiple_Agents && dotnet run


AZURE PRODUCTION
----------------
Frontend:  Can be deployed to Azure App Service
Backend:   https://durable-backend-fn.azurewebsites.net

Deployment:
- Backend: func azure functionapp publish durable-backend-fn
- Frontend: az webapp up (or manual deployment)


================================================================================
TECHNOLOGY STACK
================================================================================

FRONTEND
--------
- ASP.NET Core 8.0
- Blazor Server
- Interactive Server Components
- HTTP Client Factory

BACKEND
-------
- Azure Functions v4
- .NET 8.0 Isolated Worker
- Durable Task Framework
- Microsoft.DurableTask.Client

AI/ML
-----
- LangChain
- LangGraph (State Graph)
- Ollama (Local LLM)
- Custom AI agents

INFRASTRUCTURE
--------------
- Azure Functions (Flex Consumption)
- Azure Storage (Durable state)
- Application Insights (Monitoring)


================================================================================
SECURITY & BEST PRACTICES
================================================================================

1. HTTPS Enforcement
   - Azure Function App: httpsOnly = true
   - All external communication encrypted

2. Authentication
   - HTTP Trigger: AuthorizationLevel.Anonymous (can be changed)
   - Can add Azure AD authentication

3. Error Handling
   - Try-catch blocks in all activities
   - Proper logging with ILogger
   - Exception re-throwing for orchestrator handling

4. State Management
   - Durable Functions handles state persistence
   - Automatic checkpointing
   - Replay-safe orchestrator code

5. Monitoring
   - Application Insights integration
   - Structured logging
   - Real-time log streaming


================================================================================
SCALING & PERFORMANCE
================================================================================

FRONTEND
--------
- Blazor Server: Scales with SignalR connections
- Can handle multiple concurrent users
- State maintained per connection

BACKEND
-------
- Azure Functions: Auto-scales based on load
- Flex Consumption: 0-100 instances
- Durable Functions: Handles long-running workflows
- Stateful orchestrations survive restarts


================================================================================
FUTURE ENHANCEMENTS
================================================================================

1. Add authentication/authorization
2. Implement conversation history
3. Add multiple AI model support
4. Implement caching for responses
5. Add rate limiting
6. Implement webhook notifications
7. Add batch processing capabilities
8. Implement A/B testing for AI models


================================================================================
TROUBLESHOOTING GUIDE
================================================================================

ISSUE: Frontend can't connect to backend
SOLUTION: Check DurableBackendUrl in appsettings.json

ISSUE: 404 errors on Azure
SOLUTION: Verify functions are deployed (func azure functionapp list-functions)

ISSUE: Workflow never completes
SOLUTION: Check Azure logs (func azure functionapp logstream)

ISSUE: GraphActivity fails
SOLUTION: Check AI client configuration and Ollama/LangChain setup


================================================================================
CONTACT & RESOURCES
================================================================================

Azure Portal: https://portal.azure.com
Resource Group: durable-rg
Function App: durable-backend-fn
Location: South India

Documentation:
- Azure Durable Functions: https://docs.microsoft.com/azure/azure-functions/durable/
- Blazor: https://dotnet.microsoft.com/apps/aspnet/web-apps/blazor
- LangChain: https://python.langchain.com/


================================================================================
END OF ARCHITECTURE DOCUMENTATION
================================================================================
